<%= render layout: "layout" do %>
  <% if @conversation %>
    <p>Chatting with
      <%= render 'participants', conversation: @conversation %>
    </p>

    <div class="card">
      <div class="card-header"><%= @conversation.subject %></div>

      <div class="card-block">
        <div class="messages">
          <% @conversation.receipts_for(current_user).reverse.each do |receipt| %>
            <div class="media">
              <% message = receipt.message %>
              <div class="media-left">
                <%= render 'avatar', user: message.sender %>
              </div>

              <div class="media-body">
                <h6 class="media-heading">
                  <%= message.sender.name %> says at <%= message.created_at.strftime("%-d %B %Y, %H:%M:%S") %>
                </h6>
                <%= message.body %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
      <div class="card-footer">
        <%= form_tag reply_me_conversation_path(@conversation), method: :post do %>
          <div class="form-group">
            <%= text_area_tag 'body', nil, cols: 3, class: 'form-control', placeholder: 'Type something...', required: true %>
            <%= hidden_field_tag 'box', params[:box] %>
          </div>
          <%= submit_tag "Send Message", class: 'btn btn-primary' %>
          <%= link_to "Back", :back, class: 'btn btn-link' %>
        <% end %>
      </div>
    </div>
  <% end %>
<% end %>
